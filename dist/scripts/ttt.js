console.log("'Allo 'Allo!");var Admin=function(){function a(a){return _.find(f,function(b){return b.username===a.username})?(bootbox.alert("user exists."),!1):(f.push(a),bootbox.alert(a.username+" sign up successfully.",function(){b(a)}),!0)}function b(a){return h?void bootbox.alert(a.username+" already signed in"):_.find(f,function(b){return b.username===a.username&&b.password===a.password})?(bootbox.alert("user sign in successfully."),h=a,!0):(bootbox.alert("user and password does not match"),!1)}function c(){h?console.log(h):bootbox.alert("no user signed in."),h=null}function d(){localStorage.ttt=JSON.stringify({users:f,games:g})}function e(){localStorage.ttt=null}var f,g,h;if(Modernizr.localstorage)if(localStorage.ttt){var i=JSON.parse(localStorage.ttt);f=i.users,console.log(f),g=i.games,console.log(g)}else f=[],g=[];else bootbox.alert("Upgrade your browser");return{users:f,user:h,games:g,dirty:d,clean:e,signup:a,signin:b,signout:c}}();String.prototype.replaceAt=function(a,b){return this.substr(0,a)+b+this.substr(a+b.length)};var Board=function(){function a(a){$("#tictactoe").text(a)}function b(a){var b=a.r,c=a.c,d=a.t;$("#"+c+b).text(d),$("#"+c+b).parent().addClass("tile-new")}function c(a,b,c){$("#"+b+a).parent().addClass(c?"tile-2048":"tile-64")}function d(){$(".tile-inner").text(""),$(".tile").removeClass("tile-2048 tile-64 tile-new")}return{setTitle:a,setTile:b,highlightTile:c,clearTiles:d}}(),triples=[[{r:0,c:0},{r:0,c:1},{r:0,c:2}],[{r:1,c:0},{r:1,c:1},{r:1,c:2}],[{r:2,c:0},{r:2,c:1},{r:2,c:2}],[{r:0,c:0},{r:1,c:0},{r:2,c:0}],[{r:0,c:1},{r:1,c:1},{r:2,c:1}],[{r:0,c:2},{r:1,c:2},{r:2,c:2}],[{r:0,c:0},{r:1,c:1},{r:2,c:2}],[{r:2,c:0},{r:1,c:1},{r:0,c:2}]],Game=function(){function a(){for(var a=0;3>a;a++)for(var b=0;3>b;b++)console.log(a,b,i[a][b]),Board.setTile({r:a,c:b,t:i[a][b]})}function b(){for(var a="",b=0;3>b;b++)for(var c=0;3>c;c++)a+=i[b][c];return a}function c(a){for(var b=0;3>b;b++)for(var c=0;3>c;c++)i[b][c]=a[3*b+c]}function d(a){k=a,l=0,n=-1,j=0,Board.clearTiles(),Board.setTitle("TIC TAC TOE"),c("         "),e()}function e(){function a(a,b){setTimeout(function(){f(a,b)},400)}if(j===k)for(var b=0;3>b;b++)for(var c=0;3>c;c++)if(" "===i[b][c])return void a(b,c)}function f(a,b){if(-1===n){var c=m[j];if(" "===i[a][b]){if(i[a][b]=c,Board.setTile({r:a,c:b,t:c}),l+=1,n=g(),console.log(n),-1!==n)return void setTimeout(function(){h(n)},400);j=(j+1)%2,e()}}}function g(){for(var a=0;a<triples.length;a++){for(var b=triples[a],c="",d=0;d<b.length;d++){var e=b[d],f=e.r,g=e.c,h=i[f][g];c+=h}if("XXX"===c)return a;if("OOO"===c)return 10+a}return 9===l?-2:-1}function h(a){if(console.log(a),-2===a)return void Board.setTitle("DRAW");var b=a%10,c=Math.floor(a/10),d=c===k?"LOSE":"WIN";Board.setTitle("YOU "+d);var e=triples[b];$.each(e,function(a,b){Board.highlightTile(b.r,b.c,"WIN"===d)})}var i=[[" "," "," "],[" "," "," "],[" "," "," "]],j=0,k=1,l=0,m="XO",n=-3;return{getStatesString:b,setStatesString:c,writeToBoard:a,init:d,move:f,end:h,code:g}}();$(function(){Board.clearTiles(),Game.init(1),$(".tile-inner").click(function(){var a=this.id,b=Math.floor(a/10),c=a%10;Game.move(c,b)}),$("#Player").click(function(){Game.init(1),console.log("player start")}),$("#Computer").click(function(){Game.init(0),console.log("computer start")});var a=0;$("#Share").click(function(){a+=1}),$("#sign_in").click(function(){bootbox.prompt("Username?",function(a){a&&bootbox.prompt("Password?",function(b){if(b){var c={username:a,password:b};Admin.signin(c)}})})}),$("#sign_up").click(function(){bootbox.prompt("Username?",function(a){a&&bootbox.prompt("Password?",function(b){b&&bootbox.prompt("Email?",function(c){c&&bootbox.confirm("Comfirm? <br/>username: "+a+"<br/>password: "+b+"<br/>email: "+c,function(){if(confirm){var d={username:a,password:b,email:c};Admin.signup(d)}})})})})}),$("#sign_out").click(function(){Admin.signout()}),$("#new_game").click(function(){console.log(this.id)}),$("#save_game").click(function(){console.log(this.id)}),$("#load_game").click(function(){console.log(this.id)}),$("#match").click(function(){console.log(this.id)}),$("#leave").click(function(){console.log(this.id)}),$("#dirty").click(function(){Admin.dirty()}),$("#clean").click(function(){Admin.clean()})});